 **Mục đích:** Hộ trợ tạo Khiếu nại người bán,xử lý khiếu nại và tự động lấy mã khiếu nại từ site gốc
   
   Khiếu nại viên có thể **Tạo khiếu nại người bán**(KNNB) từ nhiều màn hình khác nhau (Hệ thống cho phép tạo KNNB cho đơn từ trạng thái **Đã Mua** trở đi và đơn ở trạng thái **Hủy** hoặc **Hết Hàng**).
   
 **Để tạo được khiếu nại người bán(KNNB) Giao dịch viên thực hiện như sau:**

 **Bước 1:** Click chọn chức năng **Tạo khiếu nại người bán** 
    
   - **Cách 1:** GDV truy cập trang **Đơn hàng** từ menu bên trái, chọn **Quản lý đơn**
  
![Quản lý đơn](https://user-images.githubusercontent.com/75475064/105575610-78a20780-5d9f-11eb-83c7-1ef5bd7a3a49.png)

   - **Cách 2:** GDV truy cập trang **Đơn hàng** từ menu bên trái, chọn **Quản lý đơn** và click vào **Mã đơn** để xem **Chi tiết đơn hàng**
  
![Chi tiết đơn](https://user-images.githubusercontent.com/75475064/105575680-fb2ac700-5d9f-11eb-96a4-2f5d00bc0962.png)

   - **Cách 3:** GDV truy cập trang **Kiểm soát mua hàng** từ menu bên trái, chọn **Kiểm soát đơn hàng**

![Kiểm soát đơn hàng](https://user-images.githubusercontent.com/75475064/105575740-5492f600-5da0-11eb-9baa-aa9240cc22b5.png)

  - **Cách 4:** GDV truy cập trang **Khiếu nại người bán** từ menu bên trái, chọn **Danh sách KNNB**
  
![Danh sách KNNB](https://user-images.githubusercontent.com/75475064/105575775-915eed00-5da0-11eb-9b08-1b8972fe7554.png)

**Lưu ý**: 
   - Quản lý có thể cài đặt **Tạo khiếu nại người bán tự động** với đơn trong mục **[Cấu hình](https://hd.gobiz.vn/m5/cau-hinh/chmuahangnhandon)** đối với đơn lâu chưa phát hàng, lâu chưa nhận hàng, đã nhận hàng nhưng chưa có kiện.  
     
   - Trên một đơn hàng, chỉ được tạo 1 KNNB cùng lý do với khi KNNB ở trạng thái **Chưa tiếp nhận** và **Đang xử lý**
  
   - Nếu KNNB ở trạng thái **Thành công** hoặc **Thất bại** thì được tạo lại KNNB cùng lý do
   
 ![](https://user-images.githubusercontent.com/75475064/101887687-ca1b7c00-3bcf-11eb-9588-fef7da1f58d4.png)
   
   
**Bước 2:** Điền trường thông tin bắt buộc như: Mã đơn hàng, Lý do, hạn xử lý,... và click **[Thực hiện]** để tạo KNNB

![Tạo mới KNNB](https://user-images.githubusercontent.com/75475064/106086456-c7abbc00-6154-11eb-8997-9de9b3f31621.png)


**Để xử lý khiếu nại người bán, Quản lý thực hiện như sau:**

**Bước 1:** Quản lý truy cập trang **Khiếu nại người bán** từ menu bên trái, chọn **Danh sách khiếu nại người bán**

![Danh sách KNNB](https://user-images.githubusercontent.com/75475064/106086927-9c759c80-6155-11eb-8f8b-b13045df4f72.png)

**Bước 2:** chọn mục **Chưa tiếp nhận** sau đó click chọn **Chi tiết** để xem chi tiết khiếu nại

![Chi tiết KNNB](https://user-images.githubusercontent.com/75475064/106087260-39383a00-6156-11eb-94a4-2b6960f4b557.png)



**Bước 3:** Quản lý xử lý KNNB

  
   * Quản lý click **Tiếp nhận** thì KNNB sẽ chuyển trạng thái sang **Đang xử lý**
   Quản lý click **Từ chối** thì KNNB sẽ chuyển trạng thái sang **Thất bại**

 ![Đang xử lý](https://user-images.githubusercontent.com/75475064/106088587-d7c59a80-6158-11eb-9020-54d869c78bd8.png)
   
 ![Đang xử lý](https://user-images.githubusercontent.com/75475064/106088714-06dc0c00-6159-11eb-8460-546f3b9d7306.png)

  * Quản lý click **Thành công**, Nhập số tiền đòi được và chọn **Thực hiện** thì  KNNB sẽ chuyển trạng thái sang **Thành công**

![Click thành công](https://user-images.githubusercontent.com/75475064/106088800-3428ba00-6159-11eb-95fa-6601b34e00ce.png)

![Nhập số tiền đòi được](https://user-images.githubusercontent.com/75475064/106088874-5cb0b400-6159-11eb-99b5-4842954f37c0.png)

![KNNB Thành công](https://user-images.githubusercontent.com/75475064/106089563-c7162400-615a-11eb-81de-d4d2080d396c.png)

  *  Quản lý click  **Thất bại** và Nhập lý do khiếu nại thất bại thì KNNB chuyển sang trạng thái **Thất bại**

![Nhập lý do thất bại](https://user-images.githubusercontent.com/75475064/106089673-02185780-615b-11eb-8718-0ee460e8b56a.png)

![KNNB thất bại](https://user-images.githubusercontent.com/75475064/106089802-4f94c480-615b-11eb-85ca-90bb485baffd.png)


**Để nhập được mã giao dịch alipay hoàn vào KNNB, quản lý thực hiện như sau:**

  * Tại màn hình **Chi tiết KNNB**, cho phép nhập **Mã giao dịch Alipay** hoàn tương ứng với KNNB này hoặc có thể chọn trong danh sách giao dịch hoàn có sẵn trên hệ thống.
  
![image](https://user-images.githubusercontent.com/75475064/101893038-c17a7400-3bd6-11eb-83b3-6b6e9e84e86c.png)

![image](https://user-images.githubusercontent.com/75475064/101893149-ec64c800-3bd6-11eb-9db2-883216aeefcd.png)

  - Đánh dấu KNNB có **tài chính hợp lệ** khi: 
  
     Tổng số tiền hoàn trên giao dịch = số tiền hoàn trên KNNB
    
     Không có mã giao dịch nào chưa có giao dịch alipay tương ứng trên hệ thống
    
     Không có mã giao dịch nào là giao dịch của đơn khác, không phải đơn của KNNB này
    
![image](https://user-images.githubusercontent.com/75475064/102747515-fe8ef500-4392-11eb-967d-d4b9f4883d92.png)
 
  - Ngoài ra, với các trường hợp sau thì KNNB **luôn luôn được đánh dấu là có tài chính hợp lệ** 
   
     KNNB chuyển sang thành công với số tiền đòi được > 0¥    
    
     KNNB chưa có số tiền đòi được và có thể có hoặc chưa có giao dịch alipay

  - Đánh dấu KNNB có **tài chính không hợp lệ** khi:
  
     KNNB được đánh dấu là "tài chính không hợp lệ" khi số tiền đòi được trên KNNB không khớp với số tiền hoàn lại từ alipay
    
     KNNB được đánh dấu là "tài chính không hợp lệ" khi số tiền đòi được trên KNNB khớp với số tiền hoàn lại từ alipay nhưng tồn tại mã giao dịch alipay không có trên hệ thống
    
![image](https://user-images.githubusercontent.com/75475064/102748041-09965500-4394-11eb-9862-7725b4192158.png)

**Lưu ý:** Hệ thống cho phép chuyển KNNB sang trạng thái thành công khi KNNB có số tiền đòi được > 0¥ và KNNB có thể có hoặc chưa có giao dịch alipay
  
   - Một giao dịch chỉ được map cho 1 KNNB
    
   - Có thể nhập mã giao dịch Alipay đã tồn tại hoặc chưa tồn tại trên hệ thống
    
   - Chỉ chấp nhận giao dịch hoàn (có số tiền là cộng)

**Để lấy thông tin khiếu nại người bán từ việc đồng bộ mã khiếu nại site gốc, quản lý thực hiện như sau:**
Tại màn hình chi tiết KNNB, nếu KNNB có mã khiếu nại trên site gốc thì khi thực hiện đồng bộ thông tin sẽ lấy được các thông tin của KNNB. 
Khi hover vào mã khiếu nại sẽ hiển thị các thông tin lấy được bao gồm:
   - Mã khiếu nại site gốc
   - Thời gian gia hạn khiếu nại
   - Trạng thái khiếu nại 
   - Mã vận đơn trả hàng
   - Mã hóa đơn gốc
   - Số tiền

![Đồng bộ KNNB](https://user-images.githubusercontent.com/76998374/104545995-d4f97e80-565d-11eb-87f5-4868ec1af481.png)


![Thông tin lấy được từ mã KN site gốc](https://user-images.githubusercontent.com/76998374/104546329-839dbf00-565e-11eb-90b6-f6e008543fd2.png)


**Logic khớp mã giao dịch dựa trên mã KN site gốc**
Trên file Mbill, khiếu nại hoàn tiền phần nội dung sẽ có mã KN site gốc như ảnh bên dưới.
Khi upload file giao dịch Mbill nếu giao dịch không map được với đơn mà trong nội dung giao dịch lại có mã KN site gốc lúc này sẽ map giao dịch này về đơn theo mã KN site gốc của KNNB và mã giao dịch alipay map với đơn có mã KN site gốc.

![File giao dịch Mbill mà nội dung file có mã KN site gốc](https://user-images.githubusercontent.com/76998374/104565722-4695f480-567f-11eb-9619-0f18e0118490.png)

Tại màn hình danh sách giao dịch alipay sẽ hiển thị mã giao dịch alipay map với MHĐG quét được từ mã KN site gốc và một mã hóa đơn gốc có thể có nhiều mã KN site gốc và 1 mã KN site gốc chỉ dành cho 1 mã hóa đơn gốc
